.. _v4.0-release-notes:

v4.0 Release Notes
==================

Administrative changes
----------------------

- `Breaking Changes`_

New Features
------------

- `Global Batch Connect items`_
- `noVNC quality and compression defaults`_
- `Batch connect sessions poll delay`_
- `System Status application`_
- `User mapping now accepts UIDs`

Thanks!
-------

We'd like to thank a bunch of folks' for contributing to this release.
As we only know the github username, that's what's being referenced here.



Details of administrative changes
---------------------------------

Breaking Changes
................

Autoloading during initialization has been removed.
***************************************************

.. include:: autoload.inc

NavConfig has been removed.
***************************

.. include:: navconfig.inc

whitelist & blacklist configs have been removed.
************************************************

.. include:: allowlist.inc

Announcements are dismissable by default.
*****************************************

In 4.0 :ref:`configure_announcements` now have the ability to be ``dismissable``.
Meaning users can press ``OK`` on the announment and it will no longer appear
on the pages.

In prior versions of Open OnDemand there was no way to dismiss or get rid of announcements.
Now in version 4.0, not only is there a way to dismiss announcements, announcements
themselves are ``dismissable`` by default.

The documentation for :ref:`configure_announcements` has been updated with this new feature.

Batch connect form ids are now lowercase.
*****************************************

To resolve some bugs with :ref:`dynamic-bc-apps`, batch connect form
items will now force lowercase HTML IDs.  This may break some javascript
at centers expecting the HTML id of the form item to be a mix of uppercase
and lowercase.

This is an example of defining a form item with uppercase keys like ``My_Cool_Form_Item``.

.. code-block:: yaml

  ---
  form:
    My_Cool_Form_Item

In this example ``My_Cool_Form_Item`` has uppercase characters, however the HTML
id of the form item will be lowercase as shown below.

.. code-block:: html

  id="batch_connect_session_context_my_cool_form_item"

Deprecations
............

POLL_DELAY is deprecated
************************

``POLL_DELAY`` is deprecated in 4.0 and being replaced
by documented configurations. See `Batch connect sessions poll delay`_
for more details.

Dependency updates
..................



SELinux changes
...............


Upgrade directions
..................



Details of new features
-----------------------

Global Batch Connect items
..........................

In 4.0 you can now define batch connect form items
in ondemand.d files to be used in any batch connect
application.

See :ref:`global_bc_form_items` for more details.

noVNC quality and compression defaults
......................................

Sites can now set the default compression and quality values
for noVNC batch connect applications through the two ``ondemand.d``
properties :ref:`novnc_default_compression <novnc_default_compression>`
and :ref:`novnc_default_quality <novnc_default_quality>`.

Batch connect sessions poll delay
.................................

When a user lands on ``My Interactive Sessions`` page,
the client browswer will request updates by default
every 10 seconds.

Sites wanting to change this had do use the hidden environment
variable ``POLL_DELAY``.

In 4.0 this is a documented configuration with ``POLL_DELAY`` being
deprecated. See :ref:`the bc_sessions_poll_delay documentation <bc_sessions_poll_delay>`
for more details.

System Status application
.........................

Your center may have deployed OSC's system status application:
https://github.com/osc/osc-systemstatus.

4.0 now ships with this application natively, though it
only supports Slurm clusters in this release.

Here's an example image from OSC detailing the system status of
our clusters.

.. figure:: /images/system-status.png
    :alt: An image showing the system status application. There are 4 panels for each cluster. Each panel shows the number of nodes available, cores available, GPUs available jobs running and jobs queued. It also shows percentages available for nodes, cores and GPUs.

This application will poll for updates at regular intervals to automatically
update the page. The default is 10 seconds. See :ref:`the documentation on status_poll_dela <status_poll_delay>`
for more details.

Visit :ref:`disabling_applications` to disable this application.

User mapping now accepts UIDs
.............................

User mapping scripts can now return a UID instead of a username.
This can be helpful for centers that have multiple domains and possible
username collisions.
